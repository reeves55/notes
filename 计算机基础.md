# 计算机基础

在计算机的世界当中，***所有程序的执行都需要依靠CPU***，程序只是定义了CPU应该做什么样的操作。你只要想做一件事儿，就必须要用到CPU。



BIOS（Basic Input Output System）：基本输入输出系统。它是一组固化到计算机内主板上一个ROM芯片上的程序 ，保存着计算机最重要的基本输入输出的程序、开机后自检程序和系统自启动程序，它可从CMOS中读写系统设置的具体信息。从奔腾时代开始，现代的电脑主板都使用NORFlash来作为BIOS的存储芯片。NORFlash容量比ROM更大还具有写入功能、写入速度快，这也为刷写BIOS提供了方便。



## 1. BIOS程序究竟做了什么工作

1. 计算机电源接通后，系统将有一个对内部各个设备进行检查的过程，这是由一个通常称之为POST（Power On Self Test/上电自检）的程序来完成，这也是BIOS程序的一个功能。完整的自检包括了对CPU、640K基本内存、1M以上的扩展内存、ROM、主板、CMOS存贮器、串并口、显示卡、软硬盘子系统及键盘的测试。在自检过程中若发现问题，系统将给出提示信息或鸣笛警告；

2. 创建BIOS中断向量（*开机时BIOS会告诉CPU各硬件设备的中断号，当用户发出使用某个设备的指令后，CPU就根据中断号使用相对应的硬件完成工作，再根据中断号跳回原来的工作*）、设置寄存器、对一些外部设备进行初始化和检测等，其中很重要的一部分是BIOS设置，主要是对硬件设置的一些参数，当计算机启动时会读取这些参数，并和实际硬件设置进行比较，如果不符合，会影响系统的启动

   **备注：** 为什么BIOS也需要中断向量呢，因为BIOS程序运行过程当中也是需要处理输入输出的呀，要不然怎么能开机按F2（部分机型）进入BIOS设置界面呢。

3. 按照系统CMOS设置中的启动顺序搜寻软、硬盘驱动器及CDROM、网络服务器等有效的启动驱动器 ，读入操作系统引导记录，然后将系统控制权交给引导记录，由引导记录完成系统的启动；

4. BIOS 向 CPU 发送一个中断 int 19h ，CPU 接收到这个中断后，会立即在中断向量表中找到 int 19h 中断向量在内存中所在的准确位置，接下来中断向量把 CPU 指向 0x0E6F2， 这个位置就是 int 0x19h 相对应的中断服务程序的入口地址，通过这段程序会把硬盘的第一个扇区中的程序（512B）加载到内存中的指定位置。

   这个就是系统的引导程序，其作用就是陆续把硬盘中的操作系统分批次的载入内存，这个引导程序称为 bootsect，是一段汇编代码，安装操作系统的时候，就会把bootsect写入到磁盘的第一个扇区里面。

   **bootsect共分为3个阶段，完成了三个阶段之后，BIOS就完成了自己所有的工作，退出开机的舞台，并关掉BIOS中断，BIOS就不再响应任何中断信号了。**

# 2. BIOS之后，就是执行setup.s汇编代码了











## 什么是中断

​	而当你需要加入新设备的时候，只需要告诉操作系统该设备占用的中断号、按照操作系统要求的接口格式撰写中断服务程序，用操作系统提供的函数注册该服务程序，设备的中断就被系统支持了。

​	中断向量代表的是中断源——从某种程度上讲，可以看作是中断或异常的类型。中断和异常的种类很多，比如说被0除是一种异常，缺页又是一种异常，网卡会产生中断，声卡也会产生中断，CPU如何区分它们呢？中断向量的概念就是由此引出的，其实它就是一个被送通往CPU数据线的一个整数。CPU给每个IRQ分配了一个类型号，通过这个整数CPU来识别不同类型的中断。

​	CPU总共可以处理256种中断，而并不知道，也不应当让CPU知道这是硬件来的中断还是软件来的中断，这样，就可以使CPU的设计独立于中断控制器的设计，这样CPU所需完成的工作就很单纯了。CPU对于其它的模块只提供了一种接口，这就是256个中断处理向量，也称为中断号。由这些中断控制器自行去使用这256个中断号中的一个与CPU进行交互，比如，硬件中断可以使用前128个号，软件中断使用后128个号，也可以软件中断使用前128个号，硬件中断使用后128个号，这与CPU完全无关了，当你需要处理的时候，只需告诉CPU你用的是哪个中断号就行，而不需告诉CPU你是来自哪儿的中断。这样也方便了以后的扩充，比如现在机器里又加了一片8259芯片，那么这个芯片就可以使用空闲的中断号，看哪一个空闲就使用哪一个，而不是必须要使用第0号，或第1号中断号了。其实这相当于一种映射机制，把IRQ信号映射到不同的中断号上，IRQ的排列或说编号是固定的，但通过改变映射机制，就可以让IRQ映射到不同的中断号，也可以说调用不同的中断服务程序。

​	“现场”看似在不断变化，没有哪个瞬间相同。但实际上组成现场的要素却不会有任何改变。也就是说，只要我们保存了相关的寄存器状态，现场就能保存下来。而恢复“现场”就是重新载入这些寄存器。换句话说，对于任何一个中断，保护现场和恢复现场所做的都是完全相同的操作。

​	首先，操作系统必须保证新的中断能够被支持。计算机系统硬件留给外设的是一个统一的中断信号接口。它固化了中断信号的接入和传递方法，拿PC机来说，中断机制是靠两块8259和CPU协作实现的。外设要做的只是把中断信号发送到8259的某个特定引脚上，这样8259就会为此中断分配一个标识——也就是通常所说的中断向量，通过中断向量，CPU就能够在以中断向量为索引的表——中断向量表——里找到中断服务程序，由它决定具体如何处理中断。