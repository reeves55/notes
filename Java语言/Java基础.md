# JavaåŸºç¡€



## é¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³



Javaæ˜¯ä¸€ä¸ªé¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ï¼Œå½“ç„¶å°±å…·å¤‡é¢å‘å¯¹è±¡çš„å‡ å¤§ç‰¹æ€§ï¼šæŠ½è±¡ã€å°è£…ã€ç»§æ‰¿ã€å¤šæ€ã€‚é¢å‘å¯¹è±¡æ˜¯ä¸€ç§ç¨‹åºè®¾è®¡æ€æƒ³ï¼Œæ˜¯ä¸ºäº†èƒ½å¤Ÿæ„å»ºå‡ºå¤§å‹çš„å¤æ‚çš„åº”ç”¨ç¨‹åºï¼Œä¸”è®©ç¨‹åºå…·æœ‰å¯æ‹“å±•æ€§ã€å¯ç»´æŠ¤æ€§å’Œä»£ç å¤ç”¨ï¼Œå½“ç„¶ï¼Œç¨‹åºçš„å¯æ‹“å±•æ€§å’Œå¯ç»´æŠ¤æ€§æ˜¯éœ€è¦è‰¯å¥½çš„ç¨‹åºè®¾è®¡å†™æ³•çš„ï¼Œä¸æ˜¯ç”¨äº†é¢å‘å¯¹è±¡æ€æƒ³å°±èƒ½å†™å‡ºè¿™ç§å¥½çš„ç¨‹åºã€‚

é¢å‘å¯¹è±¡æŠŠç”¨æ¥è§£å†³é—®é¢˜çš„ç®—æ³•åˆ†è§£ï¼Œä»ç®—æ³•ä¸­æŠ½è±¡å‡ºå¤šä¸ªç»„ä»¶ï¼ˆå¯¹è±¡ï¼‰ï¼Œæ¯ä¸ªå¯¹è±¡æ‰€è§£å†³çš„é—®é¢˜æˆ–è€…åŒ…å«çš„åŠŸèƒ½éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œé€šè¿‡è¿™äº›å¯¹è±¡ä¹‹é—´çš„äº¤äº’ï¼Œå®Œæˆç®—æ³•è¦å®ç°çš„åŠŸèƒ½ã€‚æ¦‚å†µèµ·æ¥ï¼Œå°±æ˜¯ï¼š

1. æŠ½è±¡å‡ºé—®é¢˜åŸŸä¸­çš„ç»„ä»¶
2. è®¾è®¡ä¸»æµç¨‹



æ‰€ä»¥ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯å¦‚ä½•ä»ç®—æ³•ä¸­æŠ½è±¡å‡ºæ¥éœ€è¦å“ªäº›å¯¹è±¡/ç»„ä»¶â“





ä»€ä¹ˆæ˜¯ä¸»æµç¨‹â“

ç¨‹åºçš„å…¥å£ï¼Œç®—æ³•çš„å¼€å§‹ï¼Œå°±æ˜¯æ‰§è¡ŒæŸä¸ªå¯¹è±¡çš„æŸä¸ªåŠŸèƒ½ï¼Œè¿™ä¸ªåŠŸèƒ½å¯ä»¥ç†è§£ä¸º startï¼Œæš‚ä¸”æŠŠè¿™ä¸ªåŠŸèƒ½å«åšå…¥å£åŠŸèƒ½å§ï¼ŒåŒ…å«è¿™ä¸ªå…¥å£åŠŸèƒ½çš„å¯¹è±¡å«åšå…¥å£å¯¹è±¡ï¼Œ ï¼Œè¿™ä¸ªå…¥å£åŠŸèƒ½ä¼šç”¨åˆ°å…¶ä»–å¯¹è±¡ï¼Œäºæ˜¯ï¼Œå¯¹è±¡ä¹‹é—´çš„åä½œå°±å¼€å§‹äº†ã€‚å°±åƒSpringBootç¨‹åºï¼ŒXXXApplicationå°±æ˜¯ä¸€ä¸ªå…¥å£å¯¹è±¡ã€‚



> å¦‚ä½•å®ç°ä»£ç çš„å¤ç”¨â“

ä»£ç å¤ç”¨æ— éå°±æ˜¯åˆ©ç”¨å·²çŸ¥å¯¹è±¡ï¼ˆç»„ä»¶ï¼‰æ¥æ„å»ºæ–°çš„ç»„ä»¶ï¼Œå¤ç”¨çš„æ–¹å¼æœ‰å¤šç§ï¼Œç»§æ‰¿å¯ä»¥ï¼Œç»„åˆä¹Ÿå¯ä»¥ï¼Œå»ºè®®å¤šç”¨ç»„åˆï¼Œå°‘ç”¨ç»§æ‰¿



> å¦‚ä½•è§£å†³å¯¹è±¡ï¼ˆç»„ä»¶ï¼‰ä¹‹é—´çš„è€¦åˆæ€§å’Œç¨‹åºåŠŸèƒ½å¯å˜æ€§ä¹‹é—´çš„çŸ›ç›¾â“

è¿™å°±æ˜¯å¤šæ€çš„ç”¨æ­¦ä¹‹åœ°äº†ï¼Œå®ç°ç¨‹åºå¤šæ€æ€§å¯ä»¥åˆ©ç”¨ç»§æ‰¿å’Œæ¥å£ï¼ŒæŠŠå˜åŒ–çš„éƒ¨åˆ†æ©ç›–ï¼Œæä¾›ä¸å˜çš„éƒ¨åˆ†ç»™ä½¿ç”¨è€…ï¼Œä¸æ”¹å˜ä½¿ç”¨è€…çš„ä»£ç ï¼Œå´å¯ä»¥ä»»æ„æ›´æ¢è¢«ä½¿ç”¨è€…çš„ç±»å‹ã€‚



## ç±»ã€æ¥å£ã€å¯¹è±¡

ç±»å°±æ˜¯ç®—æ³•ä¸­æˆ‘ä»¬åˆ†å‰²ï¼ŒæŠ½è±¡å‡ºæ¥çš„åŠŸèƒ½ç»„ä»¶ï¼Œå°è£…æœ€å¥½çš„ä½“ç°å°±æ˜¯å®ƒã€‚å®ƒåŒ…å«çŠ¶æ€ä»¥åŠæŸäº›åŠŸèƒ½ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯ç±»æˆå‘˜å˜é‡å’Œç±»æ–¹æ³•ã€‚

æŠ½è±¡ç±»









## æ•°æ®ç±»å‹

æ‰€ä»¥ç°åœ¨åœ¨ç¨‹åºè®¾è®¡è¯­è¨€çš„è§’åº¦ä¸Šæ¥çœ‹çœ‹Javaçš„æ•°æ®ç±»å‹ï¼Œç¨‹åºè®¾è®¡è¯­è¨€ä½¿æˆ‘ä»¬å’Œè®¡ç®—æœºè¿›è¡Œæ²Ÿé€šçš„æ¡¥æ¢å’Œå·¥å…·ï¼Œæˆ‘ä»¬æŠŠæˆ‘ä»¬çš„æ€è€ƒé€»è¾‘å˜æˆä»£ç ï¼Œç„¶åä»£ç å˜æˆè®¡ç®—æœºæŒ‡ä»¤ã€‚é€šè¿‡è®¡ç®—æœºç¨‹åºè¿™ä¸ªä¸­ä»‹ï¼Œæˆ‘ä»¬å¾—ä»¥è®©è®¡ç®—æœºæŒ‰ç…§æˆ‘ä»¬çš„æ€æƒ³è¿›è¡Œè®¡ç®—ï¼Œå¹¶å¾—å‡ºæˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚

æ•°æ®ç±»å‹æ˜¯ä»€ä¹ˆå‘¢ï¼Œæ— éå°±æ˜¯æŠŠæˆ‘ä»¬äººç±»ä¸–ç•Œç”¨åˆ°çš„æ•°æ®åˆ†åˆ†ç±»ï¼Œäººç±»ä¸–ç•Œç”¨çš„ä¸å«æ•°æ®ï¼Œå«ä¿¡æ¯ï¼Œä¿¡æ¯åœ¨è®¡ç®—æœºä¸–ç•Œé‡Œç¿»è¯‘è¿‡æ¥å°±æ˜¯æ•°æ®ï¼Œä¿¡æ¯æœ‰ç§ç±»ï¼Œæ•°æ®ä¹Ÿå°±æœ‰äº†ç§ç±»ï¼Œæ¯ç§ç±»å‹çš„æ•°æ®éƒ½æœ‰å…¶ç‰¹ç‚¹ï¼Œç¨‹åºè®¾è®¡è¯­è¨€ç»™æˆ‘ä»¬å®šä¹‰äº†æ•°æ®ç±»å‹çš„æ¦‚å¿µç”¨æ¥æ–¹ä¾¿æˆ‘ä»¬é€‰æ‹©æˆ‘ä»¬æƒ³è¦ç”¨å“ªç§ç±»å‹çš„æ•°æ®

ä¿¡æ¯å’Œæ•°æ®ä¹‹é—´å¯ä»¥ç›¸äº’è½¬æ¢ï¼Œä½†æœ‰ä¸€ä¸ªå‰ææ˜¯å¿…éœ€çš„ï¼Œé‚£å°±æ˜¯æ•°æ®ä¸€å®šè¦æœ‰è§„åˆ™ã€‚æ²¡æœ‰è§„åˆ™çš„æ•°æ®ä¸èƒ½è½¬æ¢æˆä¿¡æ¯ï¼Œä¹Ÿå°±ä¸åŒ…å«ä»»ä½•ä»·å€¼ã€‚è®¡ç®—æœºä¸Šå­˜å‚¨çš„éƒ½å«æ•°æ®ï¼Œä½†è¿™äº›æ•°æ®æ˜¯å¦éƒ½æœ‰æ„ä¹‰ï¼Œåˆ™å–å†³äºæˆ‘ä»¬æœ‰æ²¡æœ‰â€œç¿»è¯‘â€è¿™äº›æ•°æ®çš„æ–¹æ³•ã€‚ä¸¾ä¸ªğŸŒ°ï¼Œä¸€æ®µå¯†æ–‡ï¼Œåœ¨æ²¡æœ‰è§£å¯†æ–¹æ³•ä¹‹å‰ï¼Œå¯†æ–‡åªæ˜¯æ•°æ®ï¼Œå®ƒæ²¡æ³•è½¬æ¢æˆäººç±»å¯ä»¥ç†è§£çš„ï¼Œæ‰€ä»¥å®ƒä¸æ˜¯ä¿¡æ¯ï¼Œä½†æ˜¯ä¸€æ—¦æœ‰äº†è§£å¯†çš„æ–¹æ³•ï¼Œçœ‹ä¼¼ä¹±ä¸ƒå…«ç³Ÿçš„å¯†æ–‡ç«‹é©¬å°±èƒ½å˜æˆäººä»¬å¯ä»¥ç†è§£çš„ä¿¡æ¯ã€‚æ‰€ä»¥é‡ç‚¹åœ¨äºï¼šæ•°æ®çš„è§£ææ–¹æ³•ï¼Œä¹Ÿå¯ä»¥å½“æˆæ•°æ®çš„â€œç¿»è¯‘â€æ–¹æ³•ã€‚

ä»¥è¿™ä¸ªè§’åº¦æ¥çœ‹æ•°æ®ç±»å‹ï¼Œç¨‹åºè®¾è®¡è¯­è¨€å®šä¹‰çš„ç§ç§ç±»å‹ï¼Œå®é™…ä¸Šä¹Ÿå°±æ˜¯å®šä¹‰äº†ä¸€ç§ç§è§£ææ•°æ®çš„è§„åˆ™ï¼Œintç±»å‹ï¼Œåœ¨æŠŠæ•°å€¼å†™å…¥åˆ°å†…å­˜æ—¶ï¼Œä¼šæŠŠ10è¿›åˆ¶çš„å€¼å…ˆâ€œç¿»è¯‘â€äºŒè¿›åˆ¶çš„01ä¸²å†å­˜å‚¨è¿›å»ï¼Œåœ¨è¯»å–çš„æ—¶å€™ï¼Œä¼šæŠŠå†…å­˜å½“ä¸­çš„01ä¸²æ•°æ®å½“æˆä¸€ä¸ª10è¿›åˆ¶æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼ï¼Œæ‰€ä»¥ä¼šæŒ‰ç…§2è¿›åˆ¶åˆ°10è¿›åˆ¶çš„è½¬æ¢æ–¹å¼æŠŠ01ä¸²â€œç¿»è¯‘â€æˆæˆ‘ä»¬èƒ½ç†è§£çš„æ•°å­—ã€‚charç±»å‹ï¼Œä¼šæŠŠ2ä¸ªå­—èŠ‚16ä½çš„01ä¸²å½“æˆUnicodeç¼–ç å½“ä¸­çš„æ•°å­—åæ ‡ï¼Œç„¶åé€šè¿‡æŸ¥æ‰¾Unicodeæ•°å­—åæ ‡å’Œå­—ç¬¦çš„å¯¹åº”å…³ç³»ï¼Œç»™æˆ‘ä»¬å‘ˆç°å¯ä»¥è®¤è¯†çš„å­—ç¬¦ï¼Œè€Œä¸æ˜¯01äºŒè¿›åˆ¶ä¸²ã€‚

å¾ˆå®¹æ˜“ç†è§£çš„æ˜¯ï¼Œè¿™ç§è½¬æ¢è§„åˆ™æ˜¯æˆ‘ä»¬å¯ä»¥è‡ªå·±å®šä¹‰çš„ï¼Œæ‰€ä»¥æ‰æœ‰äº†åƒprotoBufferï¼Œå®ƒå®šä¹‰äº†ä¿¡æ¯å¦‚ä½•è½¬æ¢æˆäºŒè¿›åˆ¶01ä¸²ï¼Œä¹ŸåŒæ ·å®šä¹‰äº†01ä¸²å¦‚ä½•è½¬æ¢æˆç‰¹å®šç±»å‹çš„ä¿¡æ¯ã€‚æ•°æ®ç±»å‹ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç¥ç§˜çš„ï¼Œå®ƒå°±æ˜¯è¯­è¨€è®¾è®¡è€…å®šä¹‰çš„ä¸€äº›è§„åˆ™è€Œå·²ã€‚

æœ‰äº†æ•°æ®ç±»å‹è¿™ç§ç†è§£å°±å¥½è¯´æ˜ä»€ä¹ˆæ˜¯å¼ºç±»å‹è¯­è¨€ï¼Œä»€ä¹ˆæ˜¯å¼±ç±»å‹è¯­è¨€äº†ï¼Œå¼ºç±»å‹è¯­è¨€æ„å‘³ç€ä½ åœ¨ç¨‹åºå½“ä¸­ä¸€ä¸ªå˜é‡å¿…é¡»å£°æ˜ä¸ºä¸€ç§ç‰¹å®šçš„æ•°æ®ç±»å‹ï¼Œä¹‹åè¿™ä¸ªå˜é‡çš„å€¼å°±åªèƒ½å­˜å‚¨è¿™ä¸€ç§ç±»å‹çš„å€¼äº†ï¼Œå¦‚æœä½ å¯¹è¿™ä¸ªå˜é‡åšçš„æ“ä½œè¶…è¿‡äº†å˜é‡æ‰€å±æ•°æ®ç±»å‹å…è®¸çš„æ“ä½œèŒƒå›´ä¹‹å¤–ï¼Œé‚£ä¹ˆç¨‹åºåœ¨ç¼–è¯‘æœŸé—´å°±ä¼šæŠ¥é”™ï¼Œè¿™ä¸ªä¸“ä¸šç‚¹å«ç±»å‹å®‰å…¨ï¼Œè¿™æ ·ä½ å°±ä¸å¯èƒ½åœ¨æœ¬æ¥å­˜å‚¨intæ•´å‹æ•°æ®çš„å†…å­˜ç©ºé—´ä¸Šå­˜å‚¨floatæµ®ç‚¹æ•°ï¼Œå› ä¸ºå˜é‡å·²ç»å®šä¹‰æˆintç±»å‹ï¼Œé‚£ä¹ˆå¯¹å†…å­˜å½“ä¸­çš„01ä¸²çš„ç†è§£æ–¹å¼éƒ½æ˜¯æŒ‰ç…§æ•´å‹çš„è§„åˆ™æ¥çš„ï¼Œè€Œæµ®ç‚¹æ•°åœ¨å†…å­˜å½“ä¸­01ä¸²çš„è¡¨ç¤ºè§„åˆ™å’Œæ•´å‹æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ï¼Œå¼ºè¡ŒæŠŠå®ƒè§£é‡Šæˆæ•´å‹åªèƒ½å¾—åˆ°å®Œå…¨æ²¡æœ‰æ„ä¹‰çš„å€¼ï¼Œæ‰€ä»¥å¼ºç±»å‹è¯­è¨€æ˜¯ç»å¯¹ä¸å…è®¸è¿™æ ·åšçš„ï¼›è€Œå¼±ç±»å‹è¯­è¨€ä¸ä¸€æ ·ï¼Œå¼±ç±»å‹è¯­è¨€åŸºæœ¬æŒ‡çš„æ˜¯è„šæœ¬è¯­è¨€ï¼Œå®ƒæ²¡æœ‰æ•°æ®ç±»å‹è¿™ä¹ˆä¸€è¯´ï¼Œä½ æƒ³å®šä¹‰ä»€ä¹ˆæ•°æ®å°±å®šä¹‰ä»€ä¹ˆæ•°æ®ï¼Œä¸€ä¸ªvarå…³é”®å­—å°±æå®šï¼Œvar a = 1; var a = {key:"value"};var a = 1.5...ï¼Œè¿™éƒ½å¯ä»¥ï¼Œä½ å¯ä»¥å¯¹ä¸€ä¸ªå˜é‡èµ‹äºˆä¸åŒæ•°æ®ç±»å‹çš„å€¼ï¼Œæ¯”å¦‚var a=1; a=3.5; è¿™å¹¶ä¸ä¼šå¼•èµ·é”™è¯¯ï¼Œå®ƒçš„è§„åˆ™æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Œå°±æ˜¯å˜é‡å®ƒåªä»£è¡¨ä¸€ç‰‡å†…å­˜ç©ºé—´çš„åœ°å€ï¼Œä»–ä¸ç®¡ä½ è¦å¾€è¿™ç‰‡å†…å­˜ç©ºé—´é‡Œé¢å¡ä»€ä¹ˆï¼ŒåŠ å…¥ä½ å¡è¿›å»çš„æ˜¯æ•´å‹intï¼Œé‚£ä¹ˆè¿™ç‰‡å†…å­˜åŒºåŸŸå­˜å‚¨çš„å°±æ˜¯æ•°å­—çš„äºŒè¿›åˆ¶01ä¸²ï¼Œå¦‚æœä½ å¾€é‡Œé¢å¡çš„æ˜¯ä¸€ä¸ªæµ®ç‚¹æ•°floatï¼Œé‚£ä¹ˆè¿™ç‰‡å†…å­˜åŒºåŸŸå­˜å‚¨çš„å°±å˜æˆäº†æµ®ç‚¹æ•°åœ¨å†…å­˜å½“ä¸­è¡¨ç¤ºçš„01ä¸²ã€‚å½“ä½ è¦ç”¨è¿™ä¸ªå˜é‡çš„æ—¶å€™ï¼Œè¿™ç‰‡å†…å­˜åŒºåŸŸå½“ä¸­çš„01ä¸²è¯¥æŒ‰ç…§ä»€ä¹ˆè§„åˆ™å»ç†è§£å‘¢ï¼Ÿæ˜¯ä¸æ˜¯é—®é¢˜å°±æ¥äº†ï¼Œæ—¢ç„¶åŠ¨æ€è¯­è¨€ä¸ç®¡ä½ æŠŠå˜é‡èµ‹å€¼æˆä»€ä¹ˆç±»å‹ï¼Œé‚£ä¹ˆæˆ‘æ€ä¹ˆçŸ¥é“æˆ‘ç©¶ç«Ÿèµ‹å€¼äº†ä»€ä¹ˆç±»å‹å‘¢ï¼Ÿå¦‚æœä¸çŸ¥é“èµ‹å€¼äº†ä»€ä¹ˆæ•°æ®ç±»å‹ï¼Œé‚£å²‚ä¸æ˜¯è‡ªå·±æŠŠè‡ªå·±ç»™æ•´æ‡µäº†å˜›ï¼Œå“ï¼Œè¿™ä¸ªé—®é¢˜å¯ä»¥ç”¨javascriptæ¥ä¸¾ğŸŒ°ï¼Œjs åœ¨åº•å±‚å­˜å‚¨å˜é‡çš„æ—¶å€™ï¼Œä¼šåœ¨å˜é‡çš„æœºå™¨ç çš„ä½ä½1-3ä½å­˜å‚¨å…¶ç±»å‹ä¿¡æ¯ğŸ‘‰

- 000ï¼šå¯¹è±¡
- 010ï¼šæµ®ç‚¹æ•°
- 100ï¼šå­—ç¬¦ä¸²
- 110ï¼šå¸ƒå°”
- 1ï¼šæ•´æ•°

è¿™å°±æ˜¯åŠ¨æ€è¯­è¨€çŸ¥é“å½“å‰å˜é‡æ‰€å¯¹åº”çš„å†…å­˜ç©ºé—´é‡Œç©¶ç«Ÿå­˜å‚¨ç€ä»€ä¹ˆç±»å‹æ•°æ®çš„ç§˜å¯†ã€‚



å‚è€ƒï¼š

https://juejin.im/post/5b0b9b9051882515773ae714

https://lenciel.com/2016/09/types-in-programming-languages/





### é«˜çº§æ•°å­¦è®¡ç®—

#### 1. å–æ•´



#### 2. å–ä½™



#### 3. æ¬¡æ–¹ï¼ˆx^yï¼‰



#### 4. å¹³æ–¹æ ¹ç«‹æ–¹æ ¹



#### 5. ä¸‰è§’å‡½æ•°



#### 6. éšæœºæ•°







## é›†åˆ & Map





#### HashMap



HashMapä¸­tableçš„å»¶è¿Ÿåˆ›å»ºï¼Œâ€œæ‡’åŠ è½½â€

HashMapçš„æ‰€æœ‰æ„é€ å‡½æ•°ï¼ˆé™¤äº†ç”¨ä¸€ä¸ªå·²æœ‰Mapå½“åšå‚æ•°çš„æ„é€ å‡½æ•°å¤–ï¼‰å°±åªåšäº†è®¾ç½®loadFactorå’Œthresholdï¼ˆinitialCapacity * loadFactorï¼‰çš„å€¼ï¼Œæ²¡æœ‰å¯¹æ ¸å¿ƒçš„Nodeæ•°ç»„è¿›è¡Œnewçš„æ“ä½œï¼Œé‚£ä»€ä¹ˆæ—¶å€™è¿›è¡Œnewæ“ä½œå‘¢ï¼Ÿåœ¨resizeæ“ä½œçš„æ—¶å€™ï¼š

```java
        if (oldCap > 0) {
          // æ­¤æ—¶ï¼Œtableä¸ä¸ºç©ºï¼Œå·²ç»æœ‰æ•°æ®
            if (oldCap >= MAXIMUM_CAPACITY) {
                threshold = Integer.MAX_VALUE;
                return oldTab;
            }
            else if ((newCap = oldCap << 1) < MAXIMUM_CAPACITY &&
                     oldCap >= DEFAULT_INITIAL_CAPACITY)
                newThr = oldThr << 1; // double threshold
        }
				// æ­¤æ—¶
        else if (oldThr > 0) // initial capacity was placed in threshold
            newCap = oldThr;
        else {               // zero initial threshold signifies using defaults
            // æ­¤æ—¶ï¼Œ tableä¸ºç©ºï¼Œä¸” threshold==0ï¼Œä½¿ç”¨é»˜è®¤çš„ initial_capacityå’Œé»˜è®¤çš„load_factor
            newCap = DEFAULT_INITIAL_CAPACITY;
            newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);
        }

				...
        
        
```



**resizeæ“ä½œ**

* ä»€ä¹ˆæ—¶å€™è§¦å‘resizeâ“

  1. æ ¸å¿ƒæ•°æ®ç»“æ„table==null æˆ–è€… table.length==0

  2. æ¯æ¬¡å‘HashMapè¿›è¡Œputæ“ä½œä¹‹åï¼Œéƒ½ä¼šæ£€æµ‹tableä¸­çš„å…ƒç´ ä¸ªæ•°æ˜¯å¦è¶…è¿‡é˜ˆå€¼

     ```java
     float DEFAULT_LOAD_FACTOR = 0.75f;
     
     // threshold = capacity * load factor
     if (++size > threshold)
        resize();
     ```

     

* resizeæ—¶å€™ç©¶ç«Ÿåšäº†ä»€ä¹ˆâ“

  è¦ç‚¹1ï¼šå¯¹äºold tableæ•°ç»„ä¸­çš„æ¯ä¸€è¡Œï¼ˆæ•°ç»„å…ƒç´ +æ•°ç»„å…ƒç´ ä½œä¸ºå¤´ç»“ç‚¹çš„é“¾è¡¨æˆ–æ ‘ï¼‰ï¼Œåœ¨resizeä¹‹åï¼ŒèŠ‚ç‚¹çš„ä½ç½®æœ‰ä¸¤ç§å¯èƒ½ï¼Œå‡è®¾è¿™ä¸€è¡Œåœ¨æ•°ç»„ä½ç½®ä¸º indexï¼š1. èŠ‚ç‚¹çš„hash <= old capacityï¼Œè¿™ç§èŠ‚ç‚¹åœ¨resizeä¹‹åè¿˜æ˜¯å±äºè¿™ä¸€è¡Œï¼›2. èŠ‚ç‚¹çš„hash > old capacityï¼Œè¿™ç§èŠ‚ç‚¹resizeä¹‹åï¼Œå°±æ¢äº†è¡Œä½ç½®äº†ï¼Œå°±æ”¾åœ¨ old capacity + index è¿™ä¸ªä½ç½®





```java
      final Node<K,V>[] resize() {
          Node<K,V>[] oldTab = table;
          int oldCap = (oldTab == null) ? 0 : oldTab.length;
          int oldThr = threshold;
          int newCap, newThr = 0;
          if (oldCap > 0) {
              if (oldCap >= MAXIMUM_CAPACITY) {
                  threshold = Integer.MAX_VALUE;
                  return oldTab;
              }
              else if ((newCap = oldCap << 1) < MAXIMUM_CAPACITY &&
                       oldCap >= DEFAULT_INITIAL_CAPACITY)
                  newThr = oldThr << 1; // double threshold
          }
          else if (oldThr > 0) // initial capacity was placed in threshold
              newCap = oldThr;
          else {               // zero initial threshold signifies using defaults
              newCap = DEFAULT_INITIAL_CAPACITY;
              newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);
          }
          if (newThr == 0) {
              float ft = (float)newCap * loadFactor;
              newThr = (newCap < MAXIMUM_CAPACITY && ft < (float)MAXIMUM_CAPACITY ?
                        (int)ft : Integer.MAX_VALUE);
          }
          threshold = newThr;
          @SuppressWarnings({"rawtypes","unchecked"})
              Node<K,V>[] newTab = (Node<K,V>[])new Node[newCap];
          table = newTab;
          if (oldTab != null) {
              for (int j = 0; j < oldCap; ++j) {
                  Node<K,V> e;
                  if ((e = oldTab[j]) != null) {
                      oldTab[j] = null;
                      if (e.next == null)
                          newTab[e.hash & (newCap - 1)] = e;
                      else if (e instanceof TreeNode)
                          ((TreeNode<K,V>)e).split(this, newTab, j, oldCap);
                      else { // preserve order
                          Node<K,V> loHead = null, loTail = null;
                          Node<K,V> hiHead = null, hiTail = null;
                          Node<K,V> next;
                          do {
                              next = e.next;
                              if ((e.hash & oldCap) == 0) {
                                  if (loTail == null)
                                      loHead = e;
                                  else
                                      loTail.next = e;
                                  loTail = e;
                              }
                              else {
                                  if (hiTail == null)
                                      hiHead = e;
                                  else
                                      hiTail.next = e;
                                  hiTail = e;
                              }
                          } while ((e = next) != null);
                          if (loTail != null) {
                              loTail.next = null;
                              newTab[j] = loHead;
                          }
                          if (hiTail != null) {
                              hiTail.next = null;
                              newTab[j + oldCap] = hiHead;
                          }
                      }
                  }
              }
          }
          return newTab;
      }
```











å‚è€ƒï¼š

https://tech.meituan.com/2016/06/24/java-hashmap.html

















## æ–¹æ³•é‡è½½å’Œæ–¹æ³•é‡å†™

**é‡è½½**ï¼šâ‘ æ–¹æ³•åç›¸åŒï¼Œâ‘¡å‚æ•°ä¸ç›¸åŒ

**é‡å†™**ï¼šâ‘ æ–¹æ³•åç›¸åŒï¼Œâ‘¡å‚æ•°ç›¸åŒï¼Œâ‘¢è¿”å›å€¼ç±»å‹ <= çˆ¶ç±»è¿”å›å€¼ç±»å‹ï¼Œâ‘£æŠ›å‡ºå¼‚å¸¸ç±»å‹ <= çˆ¶ç±»æŠ›å‡ºå¼‚å¸¸ç±»å‹



å‚è€ƒï¼š

https://www.cnblogs.com/myworld7/p/10398335.html





### HashMap

* å’ŒHashTableåŸºæœ¬ç›¸åŒï¼Œä½†æ˜¯æ”¯æŒnull key å’Œ null value
* å…ƒç´ æ— åº
* é›†åˆéå†æ—¶ï¼Œéœ€è¦æ‰«ææ•´ä¸ªHashMapä¸­çš„æ•°ç»„é•¿åº¦åŠ ä¸Šæ¯ä¸ªæ•°ç»„bucketé“¾æ¥çš„å…ƒç´ ï¼Œæ‰€ä»¥HashMapçš„capacityè¶Šå¤§ï¼Œéå†æ‰€éœ€è¦çš„æ—¶é—´å°±è¶Šé•¿ï¼ŒHashMapä¸çŸ¥é“æ•°æ®bucketçš„å“ªäº›bucketæ˜¯å­˜å‚¨äº†å…ƒç´ çš„ï¼Œå“ªäº›æ˜¯æ²¡æœ‰çš„ï¼Œæ‰€ä»¥éœ€è¦éå†capacityé•¿åº¦çš„æ•°ç»„ã€‚
* ä¸¤ä¸ªå½±å“æ€§èƒ½çš„å…³é”®å› ç´ ï¼šinitial capacity å’Œ load factorï¼Œload factoræ˜¯è§¦å‘rehashçš„å› ç´ ï¼Œrehashå¯¼è‡´capacityå¢åŠ ä¸€å€ï¼Œ**é»˜è®¤0.75ï¼Œå¹³è¡¡æ€§èƒ½å’Œå†…å­˜ç©ºé—´å ç”¨**ã€‚
* HashMapæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œè¦ä¹ˆæŠŠHashMapåŒ…è£¹åœ¨ä¸€ä¸ªç±»é‡Œé¢ï¼Œç„¶åç±»é‡Œé¢çš„æ–¹æ³•ç”¨ ```synchronized ```ä¿®é¥°ï¼Œè¦ä¹ˆå°±æŠŠä¸€ä¸ªHashMapåœ¨åˆ›å»ºæ—¶å°±å˜æˆçº¿ç¨‹å®‰å…¨çš„ ```Map m = Collections.synchronizedMap(new HashMap(...));```
* HashMapæœ‰ ```fail-fast``` ç‰¹æ€§







###Serializable

* Serializable æ¥å£åªæ˜¯ç”¨æ¥è¯­ä¹‰ä¸Šè¡¨æ˜ä¸€ä¸ªç±»æ˜¯å¯åºåˆ—åŒ–çš„
* å¯åºåˆ—åŒ–ç±»çš„æ‰€æœ‰å­ç±»å‹æœ¬èº«éƒ½æ˜¯å¯åºåˆ—åŒ–çš„
* å¯åºåˆ—åŒ–ç±»æœ‰ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œå«åš serialVersionUIDï¼Œåºåˆ—åŒ–è¿è¡Œæ—¶ä¸ºæ¯ä¸ªå¯åºåˆ—åŒ–ç±»å…³è”ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œç§°ä¸ºserialVersionUIDï¼Œåœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä½¿ç”¨è¯¥ç‰ˆæœ¬å·æ¥ **éªŒè¯åºåˆ—åŒ–å¯¹è±¡çš„å‘é€æ–¹å’Œæ¥æ”¶æ–¹æ˜¯å¦å·²ä¸ºè¯¥å¯¹è±¡åŠ è½½äº†ä¸åºåˆ—åŒ–å…¼å®¹çš„ç±»**ã€‚å¦‚æœååºåˆ—åŒ–çš„æ—¶å€™ï¼Œæ¥æ”¶æ–¹åŠ è½½çš„ç±»çš„serialVersionUIDå’Œå‘é€æ–¹çš„ä¸ä¸€æ ·ï¼Œå°±ä¼šæŠ¥ ```InvalidClassException``` ååºåˆ—åŒ–é”™è¯¯ã€‚ç±»å¯ä»¥è‡ªå·±å£°æ˜ serialVersionUID å€¼ï¼Œä½†å¿…é¡»æ˜¯ static , final , long ç±»å‹çš„å€¼ã€‚å¦‚æœæ²¡æœ‰å£°æ˜serialVersionUIDå€¼çš„è¯ï¼Œè™šæ‹Ÿæœºåœ¨åºåˆ—åŒ–çš„æ—¶å€™ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªï¼Œä½†æ˜¯å¼ºçƒˆå‰ªå­è‡ªå·±è®¾ç½®ï¼Œå› ä¸ºè‡ªåŠ¨ç”Ÿæˆå¯èƒ½å‡ºç°å‘é€æ–¹å’Œæ¥æ”¶æ–¹åŒä¸€ä¸ªç±»çš„serialVersionUIDå€¼ä¸ç›¸åŒçš„æƒ…å†µï¼Œå¯¼è‡´ååºåˆ—åŒ–å¤±è´¥ã€‚
* **Serializableä½¿ç”¨åœºæ™¯**ï¼šéœ€è¦å°†æŸä¸ªå¯¹è±¡ä¿å­˜åˆ°ç£ç›˜ä¸Šæˆ–è€…é€šè¿‡ç½‘ç»œä¼ è¾“ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»åº”è¯¥å®ç°Serializableæ¥å£æˆ–è€…Externalizableæ¥å£ä¹‹ä¸€ã€‚
* **transient** å…³é”®å­—ä¿®é¥°ç±»çš„å±æ€§ï¼Œè¡¨ç¤ºè¯¥å±æ€§ä¸éœ€è¦åºåˆ—åŒ–ï¼Œä½¿ç”¨transientä¿®é¥°çš„å±æ€§ï¼Œjavaåºåˆ—åŒ–æ—¶ï¼Œä¼šå¿½ç•¥æ‰æ­¤å­—æ®µï¼Œæ‰€ä»¥ååºåˆ—åŒ–å‡ºçš„å¯¹è±¡ï¼Œè¢«transientä¿®é¥°çš„å±æ€§æ˜¯é»˜è®¤å€¼ã€‚å¯¹äºå¼•ç”¨ç±»å‹ï¼Œå€¼æ˜¯nullï¼›åŸºæœ¬ç±»å‹ï¼Œå€¼æ˜¯0ï¼›booleanç±»å‹ï¼Œå€¼æ˜¯falseã€‚
* è‡ªå®šä¹‰åºåˆ—åŒ–ï¼šhttps://juejin.im/post/5ce3cdc8e51d45777b1a3cdf#h



### Cloneable

* ä¸è¦ä½¿ç”¨è¿™ä¸ªæ¥å£ï¼Œæ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œ

* Objectçš„clone()æ–¹æ³•è¿”å›çš„æ˜¯å¯¹è±¡çš„æµ…æ‹·è´

* copy constructorï¼Œä¸€ç§å¯¹è±¡copyç­–ç•¥

  ```java
  class DummyBean {
    private String dummy;
  
    public DummyBean(DummyBean another) {
      this.dummy = another.dummy; // you can access  
    }
  }
  ```

* å¯ä»¥ä½¿ç”¨ï¼š

  ```java
  import org.apache.commons.lang.SerializationUtils;
  
  // æ·±æ‹·è´
  SerializationUtils.clone(Object);
  ```












> ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨ 1 << 4 æ¥è¡¨ç¤º16 ï¼Ÿ

1 <<4 çš„å€¼å’Œ16ç›¸åŒï¼Œä½†æ˜¯ 1<<4 è¿˜æœ‰å¦å¤–ä¸€ä¸ªå½¢å¼ä¸Šçš„å«ä¹‰ï¼Œå°±æ˜¯è¿™ä¸ªæ•°æ˜¯2çš„å€æ•°ï¼Œå½¢å¼ä¸Šéšå«çš„æ„æ€è¿™æ˜¯16æ— æ³•è¡¨ç¤ºçš„ï¼Œå°±åƒï¼š

```java
int day = 86400;
// vs
int day = 60 * 60 * 24; // 86400
```









### new MyClass()

åœ¨ä»»ä½•ä¸€ä¸ªåœ°æ–¹newä¸€ä¸ªå¯¹è±¡ï¼Œå°±ç›¸å½“äºæ‰§è¡Œäº†ä»¥ä¸‹çš„å­—èŠ‚ç ï¼š

```java
new           #6                  // class com/pingan/fimax/plugin/sdk/PrimaryTypeTest
dup
invokespecial #7                  // Method "<init>":()V
```

è§£é‡Šä¸€ä¸‹ä¸‰ä¸ªJVMçš„æŒ‡ä»¤ï¼š

* **new**ï¼šåé¢åŠ å¸¸é‡æ± ä¸­æŸä¸ªå€¼çš„ç´¢å¼•ï¼Œè¿™ä¸ªç´¢å¼•ä½ç½®çš„å€¼è¡¨ç¤ºçš„å°±æ˜¯ä¸€ä¸ªç±»çš„æè¿°ä¿¡æ¯ï¼Œè¿™æ ·æ ¹æ®ç±»çš„æè¿°ä¿¡æ¯å¯¹ç±»è¿›è¡ŒåŠ è½½ï¼Œç„¶åå®ä¾‹åŒ–ï¼Œåœ¨å †åŒºåŸŸåˆ›å»ºä¸€ä¸ªç±»çš„å¯¹è±¡ï¼Œ**å¹¶æŠŠè¯¥å¯¹è±¡çš„å¼•ç”¨pushåˆ°å½“å‰çš„æ“ä½œæ•°æ ˆ**ã€‚
* **dup**ï¼šæŠŠå½“å‰æ“ä½œæ•°æ ˆçš„æœ€ä¸Šé¢çš„å€¼æ‹·è´ä¸€ä»½pushåˆ°å½“å‰æ“ä½œæ•°æ ˆã€‚
* **invokespecial**ï¼šè°ƒç”¨å®ä¾‹çš„æ–¹æ³•ï¼Œåé¢è·Ÿä¸€ä¸ªå¸¸é‡æ± çš„ç´¢å¼•å€¼ï¼Œè¿™ä¸ªç´¢å¼•ä½ç½®çš„å€¼å°±æ˜¯ä¸€ä¸ªæ–¹æ³•çš„æè¿°ä¿¡æ¯ï¼Œé‚£ä¹ˆç©¶ç«Ÿè°ƒç”¨å“ªä¸ªå®ä¾‹çš„è¿™ä¸ªæ–¹æ³•å‘¢ï¼Œå°±æ˜¯æ“ä½œæ•°æ ˆpopå‡ºæ¥çš„å€¼ï¼Œä¹Ÿå°±æ˜¯åˆšåˆšdupå‡ºæ¥çš„å¯¹è±¡çš„å¼•ç”¨ã€‚

æ‰§è¡Œå®Œä¸Šé¢3æ¡æŒ‡ä»¤ä¹‹åï¼Œæ­¤æ—¶çš„æ“ä½œæ•°æ ˆè¿˜ä¿ç•™ç€å¯¹è±¡çš„å¼•ç”¨ã€‚





## å¹¶å‘ç¼–ç¨‹

å¤šçº¿ç¨‹çš„è¿è¡Œæ—¶å¿…è¦å¼€é”€æ¥è‡ªäºçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ä¼šé€ æˆä¸¤ç§å¼€é”€ï¼š

1. CPUéœ€è¦èŠ±è´¹æ—¶é—´æ¥ä¿å­˜å’Œæ¢å¤çº¿ç¨‹ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼›
2. ç¼“å­˜å¤±æ•ˆ

å½“å¤šä¸ªçº¿ç¨‹é—´å­˜åœ¨è®¿é—®å…±äº«å†…å­˜çš„æƒ…å†µæ—¶ï¼Œéœ€è¦ä½¿ç”¨ä¸€å®šçš„åŒæ­¥æœºåˆ¶æ¥é¿å…å¹¶å‘é—®é¢˜ï¼ŒåŒæ­¥æœºåˆ¶ä¼šå¯¼è‡´ï¼š

1. æŠ‘åˆ¶ç¼–è¯‘å™¨ä¼˜åŒ–ä»£ç ï¼›
2. åˆ·æ–°æˆ–è€…ä½¿CPUç¼“å­˜å¤±æ•ˆï¼›
3. åœ¨å…±äº«å†…å­˜æ€»çº¿ä¸Šå¢åŠ åŒæ­¥æµé‡



å¯¹äºä¸€ä¸ªå¯¹è±¡æ¥è¯´ï¼Œçº¿ç¨‹å®‰å…¨åŒ…æ‹¬ä¸¤ä¸ªæ–¹é¢ï¼š

1. è‡ªå·±æ‰€åœ¨çº¿ç¨‹è®¿é—®ä¸€ä¸ªå…¶ä»–çº¿ç¨‹ä¹Ÿå¯èƒ½è®¿é—®çš„å…±äº«å˜é‡æ—¶ï¼Œåè°ƒå¥½è®¿é—®é¡ºåºï¼›
2. å¤šä¸ªçº¿ç¨‹åŒæ—¶æ¥è®¿é—®è‡ªå·±çš„çŠ¶æ€å˜é‡æ—¶ï¼Œä¿è¯è‡ªå·±çŠ¶æ€çš„æ­£ç¡®æ€§ï¼›



**çº¿ç¨‹å®‰å…¨çš„ç±»**ï¼šåœ¨å¤šçº¿ç¨‹å¹¶å‘è®¿é—®ç±»çš„æ—¶å€™ï¼Œç±»ä»ç„¶èƒ½å¤Ÿä¿æŒçŠ¶æ€çš„æ­£ç¡®æ€§ï¼Œè€Œä¸éœ€è¦è°ƒç”¨è€…å¯¹è®¿é—®å…¶å±æ€§çš„æ“ä½œè¿›è¡ŒåŒæ­¥ä¿è¯ï¼Œåˆ™è¿™ä¸ªç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè¿™ä¸ªæ—¶å€™ç±»æœ¬èº«å°è£…äº†å†…éƒ¨å˜é‡è®¿é—®çš„åŒæ­¥æœºåˆ¶ã€‚



æ•°æ®æ“ä½œä¸ä¸€å®šä¼šå¼•èµ·çº¿ç¨‹å¹¶å‘é—®é¢˜ï¼Œ<span style="color:red">åªæœ‰å¯¹å…±äº«æ•°æ®çš„éåŸå­æ€§æ“ä½œä¼šå¼•å‘å¤šçº¿ç¨‹å¹¶å‘é—®é¢˜</span>ã€‚

å¦‚ä½•è®©å†…å­˜ä¸­çš„æ•°æ®åœ¨å¤šçº¿ç¨‹ç¯å¢ƒå½“ä¸­ä¿æŒæ­£ç¡®æ€§ï¼Œå…³é”®ç‚¹åœ¨äºå¯¹çº¿ç¨‹è¿›è¡ŒåŒæ­¥ï¼Œ



```java
package java.util.concurrent.atomic;
```

å¹¶å‘æ•°æ®ç±»å‹ï¼Œè¿™äº›æ•°æ®ç±»å‹ä¸ä»…å°è£…äº†æŸç§ç±»å‹çš„å€¼ï¼Œè¿˜å°è£…äº†è¿™äº›å€¼ <span style="color:red">**åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„åŒæ­¥æ“ä½œ**</span>ï¼ŒatomicåŒ…ä¸‹çš„æ•°æ®ç±»å‹ï¼Œ<span style="color:red">åŸºäºCPUçš„CASåŸå­æŒ‡ä»¤ï¼Œå®ç°åŒæ­¥æ“ä½œ</span>ã€‚

* ```AtomicInteger```ï¼š





### çº¿ç¨‹

çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿçš„æ¦‚å¿µï¼Œè€Œä¸æ˜¯CPUä¸­çš„æ¦‚å¿µï¼ŒCPUåªè´Ÿè´£æ‰§è¡ŒæŒ‡ä»¤ï¼Œæ“ä½œç³»ç»Ÿè´Ÿè´£ç»™CPUåˆ†é…å…·ä½“æ‰§è¡Œçš„çº¿ç¨‹ã€‚å³ï¼š

* çº¿ç¨‹åœ¨æ“ä½œç³»ç»Ÿå±‚æ¬¡ä¸Šåˆ›å»º
* CPUæ—¶é—´ç‰‡ç”±æ“ä½œç³»ç»Ÿåˆ‡åˆ†ï¼Œä¸€ä¸ªæ—¶é—´ç‰‡ä¹‹åï¼Œæ“ä½œç³»ç»Ÿè¿›è¡Œçº¿ç¨‹è°ƒåº¦



å¦‚æœç³»ç»Ÿå½“ä¸­è¿è¡Œçš„çº¿ç¨‹æ•°å’ŒCPUæ ¸æ•°ç›¸ç­‰ï¼Œç†è®ºä¸Šæ²¡æœ‰ä¸€ä¸ªçº¿ç¨‹éœ€è¦è¿›è¡Œåˆ‡æ¢ï¼Œéƒ½èƒ½åœ¨ä¸€ä¸ªCPUæ ¸ä¸Šä¸€ç›´è¿è¡Œã€‚





#### Linuxçº¿ç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ





posix thread lib in linuxï¼š

https://www.cs.cmu.edu/afs/cs/academic/class/15492-f07/www/pthreads.html





Linuxçº¿ç¨‹æ± å®ç°æ€è·¯ï¼š

ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œæ¯ä¸ªä»»åŠ¡æŒ‡æ˜äº†ä»»åŠ¡éœ€è¦æ‰§è¡Œçš„å‡½æ•°å’Œå‚æ•°

ä¸€å †çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æ­»å¾ªç¯å°è¯•ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡ï¼Œç„¶åæ‰§è¡Œä»»åŠ¡ä¸­æŒ‡å®šçš„å‡½æ•°ï¼Œå¹¶ä¼ é€’ç»™å‡½æ•°æŒ‡å®šçš„å‚æ•°





Javaä¸€ä¸ªçº¿ç¨‹æ˜¯å¦‚ä½•é‡å¤åˆ©ç”¨çš„







#### TreadPoolExecutor





```java
// ctl çŠ¶æ€æ§åˆ¶å˜é‡ï¼Œè¡¨ç¤ºä¸¤ä¸ªå€¼
// 1. workerCount: å·²ç»å¯åŠ¨å¹¶ä¸”ä¸ä¼šåœæ­¢çš„çº¿ç¨‹æ•°é‡
// 2. runState: çº¿ç¨‹æ± å½“å‰æ‰€å¤„çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€
```





è´Ÿæ•°ä½¿ç”¨ç›¸åº”æ­£æ•°ç»è¿‡åç è¿ç®—ä¹‹åè¡¨ç¤º

```java
// -127çš„è¡¨ç¤º
// ç›¸åº”æ­£æ•°ä¸º 01111111
// 1. å–å
// 1000000
// 2. åŠ 1
// 10000001 <- è¿™å°±æ˜¯-127å®é™…å­˜å‚¨çš„å€¼

// è´Ÿæ•°è§£ç 
// 1. å‡1
// 10000000
// 2. å–å
// 01111111 <- è¿™æ˜¯è´Ÿæ•°çš„æ­£æ•°å€¼ï¼Œæ²¡æœ‰ç¬¦å·ä½ï¼Œå°±æ˜¯127ï¼Œå› æ­¤æ­¤è´Ÿæ•°è¡¨ç¤ºçš„æ˜¯-127
```





#### Spring RequestContextHolder

ç”¨æ¥ä¿å­˜å½“å‰çš„HTTPè¯·æ±‚ä¿¡æ¯çš„ï¼Œæ˜¯å¯¹HttpServletRequestçš„ä¸€ä¸ªåŒ…è£…ï¼Œå…³é”®æ–¹æ³•æœ‰ï¼š

```java
// çº¿ç¨‹å®‰å…¨çš„ requestAttributesHolder
// æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ª RequestAttributeså¯¹è±¡
private static final ThreadLocal<RequestAttributes> requestAttributesHolder =
            new NamedThreadLocal<RequestAttributes>("Request attributes");

// è·å–å½“å‰è¯·æ±‚ç›¸å…³ä¿¡æ¯  ä½    s'd
public static RequestAttributes getRequestAttributes() {
    RequestAttributes attributes = requestAttributesHolder.get();
    if (attributes == null) {
        attributes = inheritableRequestAttributesHolder.get();
    }
    return attributes;
}

public static void setRequestAttributes(@Nullable
                                        RequestAttributes attributes,
                                        boolean inheritable);

public static RequestAttributes currentRequestAttributes()
                                                  throws IllegalStateException;

public static void resetRequestAttributes();
```



RequestAtrributesæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ¥å£æ–¹æ³•æœ‰ï¼š

| è¿”å›å€¼     | æ–¹æ³•æè¿°                                                     |
| ---------- | ------------------------------------------------------------ |
| `Object`   | `getAttribute(String name, int scope)`Return the value for the scoped attribute of the given name, if any. |
| `String[]` | `getAttributeNames(int scope)`Retrieve the names of all attributes in the scope. |
| `String`   | `getSessionId()`Return an id for the current underlying session. |
| `Object`   | `getSessionMutex()`Expose the best available mutex for the underlying session: that is, an object to synchronize on for the underlying session. |
| `void`     | `registerDestructionCallback(String name, Runnable callback, int scope)`Register a callback to be executed on destruction of the specified attribute in the given scope. |
| `void`     | `removeAttribute(String name, int scope)`Remove the scoped attribute of the given name, if it exists. |
| `Object`   | `resolveReference(String key)`Resolve the contextual reference for the given key, if any. |
| `void`     | `setAttribute(String name, Object value, int scope)`Set the value for the scoped attribute of the given name, replacing an existing value (if any). |



**Springæ¡†æ¶åœ¨DispatchServletå¤„ç†ä¸€ä¸ªHTTPè¯·æ±‚çš„é€»è¾‘ä¸­ï¼Œæ‰§è¡Œå…·ä½“è¯·æ±‚å¤„ç†æ–¹æ³•å‰ï¼Œä¼šè°ƒç”¨RequestContextHolderä¸­çš„setRequestAttributes()æ–¹æ³•ï¼š**

```java
// DispatchServletä»çˆ¶ç±»FrameServletä¸­ç»§æ‰¿çš„æ–¹æ³•
protected final void processRequest(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {

        long startTime = System.currentTimeMillis();
        Throwable failureCause = null;

        LocaleContext previousLocaleContext = LocaleContextHolder.getLocaleContext();
        LocaleContext localeContext = buildLocaleContext(request);

        RequestAttributes previousAttributes = RequestContextHolder.getRequestAttributes();
        ServletRequestAttributes requestAttributes = buildRequestAttributes(request, response, previousAttributes);

        WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);
        asyncManager.registerCallableInterceptor(FrameworkServlet.class.getName(), new RequestBindingInterceptor());

        //å…³é”®æ–¹æ³•ï¼šå°†RequestAttributesè®¾ç½®åˆ°RequestContextHolder
        initContextHolders(request, localeContext, requestAttributes);

        try {
            //å…·ä½“çš„ä¸šåŠ¡é€»è¾‘
            doService(request, response);
        }
        catch (ServletException ex) {
            failureCause = ex;
            throw ex;
        }
        catch (IOException ex) {
            failureCause = ex;
            throw ex;
        }
        catch (Throwable ex) {
            failureCause = ex;
            throw new NestedServletException("Request processing failed", ex);
        }

        finally {
            //é‡ç½®RequestContextHolderä¹‹å‰è®¾ç½®RequestAttributes
            resetContextHolders(request, previousLocaleContext, previousAttributes);
            if (requestAttributes != null) {
                requestAttributes.requestCompleted();
            }

            if (logger.isDebugEnabled()) {
                if (failureCause != null) {
                    this.logger.debug("Could not complete request", failureCause);
                }
                else {
                    if (asyncManager.isConcurrentHandlingStarted()) {
                        logger.debug("Leaving response open for concurrent processing");
                    }
                    else {
                        this.logger.debug("Successfully completed request");
                    }
                }
            }

            publishRequestHandledEvent(request, response, startTime, failureCause);
        }
    }


// åœ¨è¿™é‡Œè®¾ç½®RequestContextHolder
    private void initContextHolders(
            HttpServletRequest request, LocaleContext localeContext, RequestAttributes requestAttributes) {

        if (localeContext != null) {
            LocaleContextHolder.setLocaleContext(localeContext, this.threadContextInheritable);
        }
        if (requestAttributes != null) {
            RequestContextHolder.setRequestAttributes(requestAttributes, this.threadContextInheritable);
        }
        if (logger.isTraceEnabled()) {
            logger.trace("Bound request context to thread: " + request);
        }
    }
```



å‚è€ƒï¼š

https://www.jianshu.com/p/80165b7743cf





#### ThreadLocalçš„åŸç†

ThreadLocalç›¸å½“äºä¸€ä¸ªå®¹å™¨ï¼Œåªä¸è¿‡åªèƒ½æ”¾è¿›å»ä¸€ä¸ªå€¼è€Œå·²ï¼Œå…³é”®æ˜¯è¿™ä¸ªå€¼æ˜¯æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæŒæœ‰ä¸€ä»½çš„ï¼ŒThreadLocalå˜é‡æ”¾åœ¨å“ªé‡Œéƒ½æ— æ‰€è°“ï¼Œé‡è¦çš„æ˜¯å®ƒçš„get()æ–¹æ³•å’Œset()æ–¹æ³•ï¼Œget()æ–¹æ³•åœ¨å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡ä¸­è·å–ä¸€ä¸ªå€¼ï¼Œset()æ–¹æ³•åœ¨å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡ä¸­è®¾ç½®ä¸€ä¸ªå€¼ã€‚



| çŸ¥è¯†é¢       | çŸ¥è¯†ç‚¹                                                  | æè¿°                                                         |
| ------------ | ------------------------------------------------------- | ------------------------------------------------------------ |
| JVM åƒåœ¾å›æ”¶ | å››ç§```Reference```ç±»å‹ï¼Œå¼ºå¼•ç”¨ï¼Œè½¯å¼•ç”¨ï¼Œå¼±å¼•ç”¨ï¼Œè™šå¼•ç”¨ | è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨è™½ç„¶ä¸€èˆ¬éƒ½ä½œä¸ºç¼“å­˜åœºæ™¯ä¸­ï¼Œä½†æ˜¯è½¯å¼•ç”¨çš„ç¼“å­˜æ˜¯åœ¨å†…å­˜å®åœ¨ä¸å¤Ÿç”¨çš„æ—¶å€™ï¼Œå›æ”¶æ‰ï¼Œå›æ”¶ä¹‹å‰ï¼Œéƒ½æ˜¯ä¸€ç›´æœ‰ç”¨çš„ï¼Œè€Œå¼±å¼•ç”¨å°±ä¸ä¸€æ ·äº†ï¼Œè¿™ç§ç¼“å­˜å…¶å®å¯èƒ½åªç”¨å‡ æ¬¡å°±ä¸ç”¨äº†ä¸ä¼šä¸€ç›´ç”¨ï¼Œæ‰€ä»¥åŠæ—¶å›æ”¶æ‰æ˜¯æ­£é“ |



#### Object notify wait & synchronized

åŸºäºä¸€ä¸ªå¯¹è±¡çš„é”ï¼Œé”æ˜¯ä»€ä¹ˆæ¦‚å¿µï¼Œé”å¯ä»¥ç†è§£ä¸ºæ‰“å¼€æ–°ä¸–ç•Œçš„é’¥åŒ™ï¼Œæ˜¯ä¸€ä¸ªä»¤ç‰Œï¼Œåªæœ‰æ‹¿åˆ°è¿™ä¸ªé”ï¼Œæ‰èƒ½åšæŸäº›äº‹æƒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ ```synchronized(obj)```ï¼Œ```ReentrantLock lock = new ReentrantLock(); lock.lock();```ï¼Œé”çš„ä½¿ç”¨å¿…ç„¶å’ŒæŸä¸ªå®ä½“ç›´æ¥ç›¸å…³ï¼Œé‚£ä¸ªå®ä½“å°±æ˜¯é”ï¼Œæ‹¥æœ‰å®ä½“çš„çº¿ç¨‹æ‰èƒ½æ‰§è¡ŒæŸä¸€éƒ¨åˆ†çš„ä»£ç ï¼Œè€Œå®ä½“ä»…æœ‰ä¸€ä»½ï¼Œä¸¤è€…ç»“åˆï¼Œä¿è¯äº†çº¿ç¨‹åŒæ­¥æ‰§è¡Œã€‚



Objectçš„ ```notify ``` å’Œ ```wait``` ç³»åˆ—æ–¹æ³•æ˜¯ç”¨æ¥å’Œ ```synchronized``` å…³é”®å­—é…åˆä½¿ç”¨ï¼Œå®ç°ä½¿ç”¨åŒä¸€ä¸ªèµ„æºçš„å¹¶å‘çº¿ç¨‹å¯ä»¥è¿›è¡Œé€šçŸ¥çš„æ“ä½œã€‚é…åˆä½¿ç”¨çš„æ–¹æ³•å°±æ˜¯ synchronized é”ä½çš„å¯¹è±¡å’Œç”¨æ¥é€šçŸ¥çš„å¯¹è±¡æ˜¯åŒä¸€ä¸ªå¯¹è±¡

```java
Object obj = new Object();

// thread 1 åæ‰§è¡Œ
Thread.sleep(1000);

synchronized(obj) {
  System.out.println("thread 1 get monitor and notify thread2");
	obj.notifyAll();
  System.out.println("leave thread 1");
}

// thread 2 å…ˆæ‰§è¡Œ
synchronized(obj) {
  System.out.println("thread 2 will wait and handle out monitor");
  obj.wait();
  System.out.println("thread 2 continue to do something");
}

// è¾“å‡º
// thread 2 will wait and handle out monitor
// thread 1 get monitor and notify thread2
// leave thread 1
// thread 2 continue to do something
```



#### synchronizedé”çŠ¶æ€åˆ‡æ¢

JDK1.6ä¹‹å‰ï¼Œsynchronizedçš„æ€§èƒ½è¿œä¸åŠReentrantLockï¼Œé‚£æ˜¯å› ä¸ºsynchronizedåªæœ‰é‡é‡çº§é”ï¼ŒJDK1.6ï¼Œsynchronizedåšäº†å¤§é‡çš„é”ä¼˜åŒ–ï¼Œæ€§èƒ½å·²ç»å’ŒReentrantLockæŒå¹³ã€‚



**åå‘é”**ï¼šåå‘é”æ˜¯ä¸ºäº†ä¸€ä¸ªåŒæ­¥ä»£ç å—ä¸€ç›´åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—®çš„æƒ…å½¢ï¼Œä¸å­˜åœ¨ç«äº‰ã€‚å¥½å¤„æ˜¯è¿™ä¸ªæ—¶å€™çº¿ç¨‹è®¿é—®åŒæ­¥ä»£ç å—åªéœ€è¦åˆ¤æ–­é”çš„å¯¹è±¡å¤´çš„åå‘é”æŒ‡å®šçš„çº¿ç¨‹IDæ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹å³å¯ï¼Œä¸éœ€è¦å…¶ä»–å¤æ‚æ“ä½œï¼Œæ•ˆç‡æé«˜ï¼ˆåå‘é”å¦‚ä½•ä»åå‘ä¸€ä¸ªçº¿ç¨‹åˆ‡æ¢æˆåå‘å¦ä¸€ä¸ªçº¿ç¨‹å‘¢ï¼Ÿï¼‰



**è½»é‡çº§é”**ï¼šè½»é‡çº§é”æ˜¯ä¸ºäº†ä¸€ä¸ªåŒæ­¥ä»£ç å—å­˜åœ¨çº¿ç¨‹ç«äº‰æƒ…å†µï¼Œä½†æ˜¯ç«äº‰ä¸æ¿€çƒˆï¼Œæˆ–è€…äº¤æ›¿è®¿é—®ä¸ç«äº‰æ—¶çš„æƒ…å½¢ã€‚



**é‡é‡çº§é”**ï¼šé‡é‡çº§é”æ˜¯ä¸ºäº†ä¸€ä¸ªåŒæ­¥ä»£ç å—å¤šä¸ªçº¿ç¨‹æ¿€çƒˆç«äº‰çš„æƒ…å†µï¼Œè®¸å¤šçº¿ç¨‹æŠ¢å Monitorï¼Œçº¿ç¨‹åŒæ­¥è®¿é—®ä»£ç å—ã€‚

**è‡ªæ—‹é”**ï¼š



**é”æ¶ˆé™¤**ï¼š



**é”ç²—åŒ–**ï¼š







åŒé‡æ£€æŸ¥é”çš„å•ä¾‹æ¨¡å¼ï¼Œå±äºæ‡’åŠ è½½









####å­—ç¬¦ä¸²ä¸ºä»€ä¹ˆåœ¨Javaä¸­è®¾è®¡æˆä¸å¯å˜ï¼Œå¦‚ä½•å®ç°ä¸å¯å˜çš„ï¼Ÿ

**ä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡**ï¼š<span style="color:red">1ï¼‰</span>ç¨‹åºå½“ä¸­å¤§é‡ä½¿ç”¨å­—ç¬¦ä¸²ï¼Œå¦‚æœå­—ç¬¦ä¸²èƒ½å¤Ÿç¼“å­˜èµ·æ¥ï¼Œå¿…å®šèƒ½æé«˜ç¨‹åºè¿è¡Œæ•ˆç‡ï¼Œä½†æ˜¯å¦‚æœæ˜¯æ‰€æœ‰ç¼“å­˜çš„å­—ç¬¦ä¸²æ± ï¼Œå¤šä¸ªå˜é‡çš„å€¼ç›¸åŒæ—¶ï¼Œé‚£ä¹ˆå®ƒä»¬è‚¯å®šæŒ‡å‘å­—ç¬¦ä¸²æ± å½“ä¸­åŒä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœå­—ç¬¦ä¸²æ˜¯å¯å˜çš„è¯ï¼Œä¸€ä¸ªç¨‹åºæ”¹å˜äº†å­—ç¬¦ä¸²çš„å€¼ï¼Œå…¶ä»–çš„å˜é‡éƒ½å—åˆ°äº†å½±å“ï¼Œæ‰€ä»¥å­—ç¬¦ä¸²å¾—æ˜¯ä¸å¯å˜çš„æ‰è¡Œã€‚<span style="color:red">2ï¼‰</span>å®‰å…¨é—®é¢˜ï¼ŒJavaä½¿ç”¨å­—ç¬¦ä¸²æ¥è¡¨ç¤ºç±»çš„æƒé™å®šåï¼Œä¹Ÿæ˜¯é€šè¿‡ç±»çš„åå­—æ¥åŠ è½½ç±»çš„ï¼Œå¦‚æœå­—ç¬¦ä¸²æ˜¯å¯å˜çš„ï¼Œå°±å¯èƒ½äº§ç”ŸåŸå…ˆè¦åŠ è½½ç±»```java.io.Writer``` å˜æˆäº†åŠ è½½ ```mil.vogoon.DiskErasingWriter```ï¼› <span style="color:red">3ï¼‰</span>Stringä¸å¯å˜ï¼Œé‚£ä¹ˆå­—ç¬¦ä¸²å¯¹è±¡å°±å¯ä»¥ç¼“å­˜èµ·hashcodeçš„å€¼ï¼Œè¿™æ ·Stringä½œä¸ºHashMapçš„Keyæ—¶ï¼Œå°±ä¸éœ€è¦å…ˆè®¡ç®—å¯¹è±¡çš„hashcodeäº†ï¼Œæ•ˆç‡æ›´é«˜ã€‚



**å¦‚ä½•å®ç°**ï¼š<span style="color:red">1ï¼‰</span>Stringç±»æ˜¯finalçš„ï¼Œä¸å¯ç»§æ‰¿ï¼Œç”¨æˆ·æ— æ³•æ”¹å˜Stringç‰¹ç‚¹ï¼›<span style="color:red">2ï¼‰</span>å®é™…å­˜å‚¨å­—ç¬¦ä¸²çš„char[]æ˜¯privateçš„ï¼Œcharå˜é‡æ˜¯finalç±»å‹çš„ï¼Œæ— æ³•æ”¹å˜char[]ä¸­çš„ä»»ä½•ä¸€ä¸ªå­—ç¬¦çš„å€¼ã€‚











### çº¿ç¨‹æ± 



1. ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹æ± â“

   å…³é”®ç‚¹ï¼š```çº¿ç¨‹èµ„æºå¤ç”¨```ï¼Œ```é˜»å¡é˜Ÿåˆ—ç¼“å†²ä»»åŠ¡```ï¼Œ

   å¯¹äº<span style="color:red">è¿è¡Œæ—¶é—´çŸ­Â </span>ä¸” <span style="color:red">é¢‘ç¹è¿è¡Œ</span>çš„ä»»åŠ¡ï¼Œé€‚åˆä½¿ç”¨çº¿ç¨‹æ± ï¼Œå¯ä»¥è¾¾åˆ°å¾ˆå¥½çš„çº¿ç¨‹å¤ç”¨çš„æ•ˆæœï¼Œèµ„æºåˆ©ç”¨ç‡æ›´é«˜ï¼›

   



#### ThreadPoolExecutor

å¸¸ç”¨æ„é€ æ–¹æ³•ä¸ºï¼š

```java
ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler)
```

1. ```corePoolSize```ï¼š çº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹çš„æœ€å°‘æ•°é‡
2. ```maximumPoolSize```ï¼šçº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹çš„æœ€å¤§æ•°é‡
3. ```keepAliveTime```ï¼š çº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹æ‰€å…è®¸çš„ç©ºé—²æ—¶é—´
4. ```unit```ï¼š çº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹æ‰€å…è®¸çš„ç©ºé—²æ—¶é—´çš„å•ä½
5. ```workQueue```ï¼š <span style="color:red">çº¿ç¨‹æ± æ‰€ä½¿ç”¨çš„ç¼“å†²é˜Ÿåˆ—</span>
6. ```threadFactory```ï¼šåˆ›å»ºæ–°çº¿ç¨‹çš„å·¥å‚
7. ```handler```ï¼š <span style="color:red">çº¿ç¨‹æ± å¯¹æ‹’ç»ä»»åŠ¡çš„å¤„ç†ç­–ç•¥</span>



handlerçš„é€‰æ‹©ï¼š

* ThreadPoolExecutor.AbortPolicy() ï¼šæŠ›å‡ºjava.util.concurrent.RejectedExecutionExceptionå¼‚å¸¸

* ThreadPoolExecutor.CallerRunsPolicy() : é‡è¯•æ·»åŠ å½“å‰çš„ä»»åŠ¡ï¼Œä»–ä¼šè‡ªåŠ¨é‡å¤è°ƒç”¨execute()æ–¹æ³•

* ThreadPoolExecutor.DiscardOldestPolicy() : æŠ›å¼ƒæ—§çš„ä»»åŠ¡
* ThreadPoolExecutor.DiscardPolicy() : æŠ›å¼ƒå½“å‰çš„ä»»åŠ¡





##### FutureTask

1. ```public void execute(Runnable command);```
2. ```Future<?> submit(Runnable task);```
3. ```public <T> Future<T> submit(Runnable task, T result);```
4. ```public <T> Future<T> submit(Callable<T> task);```



<img src="https://tuchuang-1256253537.cos.ap-shanghai.myqcloud.com/tuchuang/image-20200324221157738.png" alt="image-20200324221157738" style="zoom:55%;float:right;margin-right:40px" />

3ä¸ªè¿”å›Futureçš„æ–¹æ³•å®é™…ä¸Šè¿”å›çš„éƒ½æ˜¯ ```FutureTask``` å¯¹è±¡ï¼Œæ—¢ç„¶FutureTaskæ˜¯çº¿ç¨‹æ± è¿”å›çš„ï¼Œè¿™ä¸ªå¯¹è±¡åœ¨çº¿ç¨‹æ± è¿è¡Œä»»åŠ¡è¿‡ç¨‹ä¸­ï¼Œè‚¯å®šä¼šå¼•ç”¨è¯¥å¯¹è±¡ï¼Œåœ¨ä¸»çº¿ç¨‹ä¹Ÿæ˜¯é€šè¿‡FutureTaskæ¥è·å–æ‰§è¡Œç»“æœï¼Œå°±æ„å‘³ç€è¿™ä¸ªå¯¹è±¡è‡³å°‘è¢«ä¸¤ä¸ªçº¿ç¨‹å…±äº«ï¼Œçº¿ç¨‹æ± åœ¨ä»»åŠ¡æ‰§è¡Œç»“æŸè‚¯å®šè¦å”¤é†’ç­‰å¾…åœ¨è¿™ä¸ªå¯¹è±¡ä¸Šçš„ä¸»çº¿ç¨‹ï¼Œè®©ä¸»çº¿ç¨‹èƒ½å¤Ÿè·å–åˆ°ç»“æœè¿”å›ç»§ç»­è¿è¡Œï¼Œæäº¤ä»»åŠ¡çš„æ—¶å€™æ˜¯åŒæ­¥éé˜»å¡çš„ï¼Œåœ¨è·å–ä»»åŠ¡æ‰§è¡Œç»“æœçš„æ—¶å€™æ˜¯åŒæ­¥é˜»å¡çš„ã€‚



<img src="https://tuchuang-1256253537.cos.ap-shanghai.myqcloud.com/tuchuang/image-20200324215900501.png" alt="image-20200324215900501" style="zoom:50%;" />









çº¿ç¨‹ï¼š

å¯ä»¥é€šè¿‡ ```setDamon(boolean on)``` ï¼ŒæŠŠä¸€ä¸ªçº¿ç¨‹è®¾ç½®æˆå®ˆæŠ¤çº¿ç¨‹ï¼Œå®ˆæŠ¤çº¿ç¨‹çš„å­˜åœ¨ä¸ä¼šå½±å“JVMé€€å‡ºï¼ˆåªè¦æœ‰ä¸€ä¸ªéå®ˆæŠ¤çº¿ç¨‹è¿è¡Œï¼ŒJVMå°±ä¸ä¼šé€€å‡ºï¼Œå¦åˆ™JVMå°†ä¼šé€€å‡ºï¼ŒJVMé€€å‡ºæ—¶ï¼Œæ‰€æœ‰å®ˆæŠ¤çº¿ç¨‹éƒ½ä¼šè¢«åœæ­¢ï¼‰

çº¿ç¨‹ç»„ï¼š

åœ¨Javaå½“ä¸­ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½å±äºæŸä¸ªçº¿ç¨‹ç»„ï¼Œmainçº¿ç¨‹å±äº system çº¿ç¨‹ç»„ï¼Œå½“æˆ‘ä»¬åœ¨new Thread() çš„æ—¶å€™ï¼Œå¦‚æœä¸æŒ‡å®šå½“å‰çº¿ç¨‹å±äºå“ªä¸ªçº¿ç¨‹ç»„ï¼Œé»˜è®¤å±äºåˆ›å»ºå½“å‰çº¿ç¨‹çš„çº¿ç¨‹æ‰€å±çš„çº¿ç¨‹ç»„ï¼Œä¹Ÿå°±æ˜¯ parent.getThreadGroup()ï¼ŒThreadGroupå¯ä»¥æ‰¹é‡interruptç»„å†…çº¿ç¨‹ã€‚

![img](https://images2015.cnblogs.com/blog/801753/201510/801753-20151005180622909-789401754.png)





## æ–‡ä»¶IO















## ç½‘ç»œç¼–ç¨‹



### InetAddress

å¯¹è®¡ç®—æœº IP åœ°å€çš„æŠ½è±¡ï¼Œ



![image-20200415140048096](https://tuchuang-1256253537.cos.ap-shanghai.myqcloud.com/img/image-20200415140048096.png)



ä»€ä¹ˆæ˜¯ DNS spoofing attacksï¼ˆDNSæ¬ºéª—æ”»å‡»ï¼‰

![img](https://tuchuang-1256253537.cos.ap-shanghai.myqcloud.com/img/102017_0742_Ettercap1.png)





å‚è€ƒï¼šhttps://stackoverflow.com/questions/1256556/how-to-make-java-honor-the-dns-caching-timeout





### NIO



![image-20200321120909713](https://tuchuang-1256253537.cos.ap-shanghai.myqcloud.com/tuchuang/image-20200321120909713.png)





å¦‚æœä¸€ä¸ªSocketChannelè°ƒç”¨ register æ–¹æ³•æ³¨å†Œåˆ°Selectorä¸Šé¢ä¼šè¿”å›ä¸€ä¸ªSelectionKeyï¼Œè¿™ä¸ªSelectionKeyæ³¨å†Œåœ¨Selectorä¸Šé¢ï¼Œå¦‚æœè°ƒç”¨ cancel æ–¹æ³•å–æ¶ˆæ³¨å†Œæ—¶ï¼ŒSelectionKeyå¹¶ä¸ä¼šè¢«ç§»é™¤ï¼Œä¼šè¢«æ·»åŠ åˆ°Selectorçš„cancelled-key setï¼Œç­‰åˆ°ä¸‹æ¬¡è¿è¡Œ Selector.select æ–¹æ³•çš„æ—¶å€™æ‰ä¼šæ¸…é™¤è¿™äº›è¢«å–æ¶ˆçš„SelectionKey



å‚è€ƒï¼š

https://docs.oracle.com/javase/8/docs/api/java/nio/channels/SelectionKey.html











formè¡¨å•æäº¤çš„æ•°æ®ï¼Œå¦‚æœæ˜¯é€šè¿‡ ```application/x-www-form-urlencoded``` ç±»å‹å‘é€çš„ï¼Œå°±æ˜¯æŠŠè¡¨å•æ•°æ®è½¬æ¢æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²æŠŠè¡¨å•æ‰€æœ‰æ§ä»¶çš„å€¼éƒ½å›Šæ‹¬åˆ°ä¸€èµ·ï¼Œä½œä¸ºæ¶ˆæ¯å†…å®¹å‘é€åˆ°æœåŠ¡ç«¯ã€‚è€Œ ```multipart/form-data``` ä¸ä¸€æ ·ï¼Œè¿™ç§ç±»å‹ä¸‹ï¼Œæ¶ˆæ¯å†…å®¹ä¸­è¡¨å•æ¯ä¸ªæ§ä»¶çš„å€¼éƒ½æ˜¯åˆ†éš”å¼€æ¥çš„ï¼Œå„è‡ªæˆä¸ºä¸€å—ã€‚







###HttpUrlConnection



#### multipart/form-data request

ä¸»è¦çš„æœ‰ä¸¤ä¸ªç‚¹ï¼Œä¸€ä¸ªæ˜¯Content-Type HTTP headeréœ€è¦è®¾ç½®æˆ

 ```Content-Type: multipart/form-data;boundary="boundary"``` ï¼›

å¦ä¸€ä¸ªæ˜¯HTTP request bodyçš„æ ¼å¼è¦è®¾ç½®æˆï¼š

```html
--boundary 
Content-Disposition: form-data; name="field1" 
Content-Type: XXX

value1 
--boundary 
Content-Disposition: form-data; name="field2"; filename="example.txt" 
Content-Type: XXX

value2

......

--{boundary}--\r\n (<-è¿™ä¸ªæ˜¯ç»“å°¾)
```



å…¶ä¸­ï¼Œ```Content-Disposition``` æŒ‡æ˜äº†è¿™ä¸ªpartçš„ç›¸å…³ä¿¡æ¯

```
Content-Disposition: form-data; [name="xxx";] [filename="xxx"]
```



#### application/x-www-form-urlencoded request

è¦å‘é€è¿™ç§æ ¼å¼çš„httpè¯·æ±‚ï¼Œæœ€é‡è¦çš„å°±æ˜¯è®¾ç½®http request bodyçš„æ ¼å¼æ˜¯ param=value&...è¿™ç§æ ¼å¼ï¼Œå¹¶ä¸”æ•´ä¸ªå­—ç¬¦ä¸²è¦ä½¿ç”¨url encodeè¿›è¡Œç¼–ç 

```java
try{
  // create http connection from url
	String requestUrl = "<Url here>";
	String urlParameters  = "param1=data1&param2=data2&param3=data3";
  // url encode
  urlParameters = URLEncoder.encode(urlParameters, StandardCharsets.UTF_8);
	byte[] postData = urlParameters.getBytes();
	URL url = new URL(requestUrl);
	HttpURLConnection conn= (HttpURLConnection) url.openConnection(); 

	// set http request method
	conn.setRequestMethod("POST");

	// set http request header
	conn.setRequestProperty("Content-Type", "application/x-www-form-urlencoded"); 
	conn.setRequestProperty("charset", "utf-8");

	// indicate http has request body
	conn.setDoOutput(true);
  // indicate will read response body
  conn.setDoInput(true);

	// send http request body
	BufferedOutputStream wr = new BufferedOutputStream (connection.getOutputStream ());
	wr.write(postData);
	wr.flush ();

	// get response status code
  int statusCode = conn.getResponseCode();
  if (statusCode != 200) {
    return;
  }
  
  HttpResponse response = new HttpResponse();
  response.setHeaders(conn.getHeaderFields());
  response.setStatus(statusCode);
  
  // get response body
	InputStream is = connection.getInputStream();
  if (is != null) {
       ByteArrayOutputStream outStream = new ByteArrayOutputStream();
       byte[] buffer = new byte[1024];
       int len = 0;
       while ((len = is.read(buffer)) != -1) {
           outStream.write(buffer, 0, len);
       }
       response.setBody(outStream.toByteArray());
  }
  
} catch (IOException e) {
  
} finally {
  if(wr != null) {
    try{
      wr.close();
    }catch(IOException e) {
      e.printStackTrace();
    }
  }
  
  if(response != null) {
    try {
      response.close();
    }catch(IOException e) {
      e.printStackTrace();
    }
  }
}


```



ä¸Šé¢ä»£ç ä½¿ç”¨äº†è‡ªå®šä¹‰çš„HttpResponseç±»ï¼š

```java
public class HttpResponse {
    private Map<String, List<String>> headers;
    private byte[] body;
    private String encoding;
    private int status;

    public HttpResponse() {
    }

    public Map<String, List<String>> getHeaders() {
        return headers;
    }

    public void setHeaders(Map<String, List<String>> headers) {
        this.headers = headers;
    }

    public byte[] getBody() {
        return body;
    }

    public void setBody(byte[] body) {
        this.body = body;
    }

    public String getEncoding() {
        return encoding;
    }

    public void setEncoding(String encoding) {
        this.encoding = encoding;
    }

    public int getStatus() {
        return status;
    }

    public void setStatus(int status) {
        this.status = status;
    }
}
```



å¹¶ä¸æ˜¯æ‰€æœ‰çš„XXXOutputStreaméƒ½æœ‰Javaä»£ç çº§åˆ«çš„ç¼“å­˜ï¼ŒBufferedOutputStreamå°±æœ‰ç¼“å­˜ï¼Œå®ƒçš„flushæ–¹æ³•ä¼šè°ƒç”¨outputstream.writeæ–¹æ³•ï¼ŒæŠŠç¼“å­˜çš„æ•°æ®éƒ½å†™åˆ°æµï¼Œä½†æ˜¯DataOutputStreamçš„flushæ–¹æ³•å°±æ˜¯ç›´æ¥è°ƒç”¨OutputStreamçš„flushæ–¹æ³•ï¼Œé»˜è®¤ä»€ä¹ˆéƒ½ä¸åšã€‚



Java HttpUrlConnectionçš„connect()æ–¹æ³•ï¼Œæ˜¯å‘èµ·è¿æ¥çš„æ„æ€ï¼ŒURL.openConnection()åªæ˜¯åˆ›å»ºäº†ä¸€ä¸ªHttpURLConnectionè¯·æ±‚å¯¹è±¡ï¼Œè°ƒç”¨HttpURLConnectionå¯¹è±¡çš„getOutputStream()æ–¹æ³•å’ŒgetInputStream()æ–¹æ³•éƒ½ä¼šéšå¼è°ƒç”¨HttpURLConnectionçš„connect()æ–¹æ³•ã€‚







#### application/x-www-form-urlencoded å­—ç¬¦ç¼–ç 

è¿™ç§ç±»å‹çš„è¯·æ±‚ä¸­ï¼Œè¯·æ±‚ä½“ï¼Œä¹Ÿå°±æ˜¯æ¶ˆæ¯å†…å®¹éƒ¨åˆ†çš„å­—ç¬¦æ˜¯ç»è¿‡url ç¼–ç åçš„å­—ç¬¦ï¼Œè§„èŒƒè§„å®šäº†ï¼Œurl ç¼–ç å­—ç¬¦é›†åŒ…æ‹¬ï¼š

> Urlä¸­åªå…è®¸åŒ…å«è‹±æ–‡å­—æ¯ï¼ˆa-zA-Zï¼‰ã€æ•°å­—ï¼ˆ0-9ï¼‰ã€-_.~4ä¸ªç‰¹æ®Šå­—ç¬¦ä»¥åŠæ‰€æœ‰ä¿ç•™å­—ç¬¦ï¼Œå…¶ä¸­ï¼Œä¿ç•™å­—ç¬¦åŒ…æ‹¬ !	*	'	(	)	;	:	@	&	=	+	$	,	/	?	#	[	]

å¯¹äºå…è®¸èŒƒå›´ä¹‹å¤–çš„å­—ç¬¦ï¼Œåˆ™éœ€è¦ä½¿ç”¨å…è®¸çš„å­—ç¬¦é›†å¯¹å…¶è¿›è¡Œç¼–ç ã€‚



ASCIIç ä¸­ä¿ç•™å­—ç¬¦çš„ç¼–ç ï¼š

| !     | *     | "     | '     | (     | )     | ;     | :     | @     | &     |
| ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- |
| `%21` | `%2A` | `%22` | `%27` | `%28` | `%29` | `%3B` | `%3A` | `%40` | `%26` |
| **=** | **+** | **$** | **,** | **/** | **?** | **%** | **#** | **[** | **]** |
| `%3D` | `%2B` | `%24` | `%2C` | `%2F` | `%3F` | `%25` | `%23` | `%5B` | `%5D` |

ASCIIç ä¸­ä¸å®‰å…¨å­—ç¬¦çš„ç¼–ç ï¼š

> ç©ºæ ¼ã€< > { } | \ ^ ` ~

ä¸å®‰å…¨çš„å­—ç¬¦é‡‡ç”¨ç™¾åˆ†å·ç¼–ç ï¼Œå°±æ˜¯ % + å­—ç¬¦å­—èŠ‚åå…­è¿›åˆ¶å­—ç¬¦ä¸²



éASCIIç å­—ç¬¦çš„ç¼–ç ï¼š

å…ˆå¯¹å­—ç¬¦è¿›è¡Œä¸€æ¬¡ç¼–ç ï¼Œæ¯”å¦‚UTF-8ç¼–ç ï¼Œç„¶åå¯¹ç¼–ç åçš„å­—èŠ‚è¿›è¡Œç™¾åˆ†å·ç¼–ç ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªå­—èŠ‚ç¼–ç æˆ % + å­—èŠ‚çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²

<span style="color:red">æ³¨æ„ï¼šéASCIIç å­—ç¬¦æ˜¯æ²¡æœ‰ç»Ÿä¸€çš„æ ‡å‡†ç¼–ç æ–¹å¼çš„</span>





#### HTTPåè®®æ•°æ®åŒ…çš„ç¼–ç æ–¹å¼

ä¼ è¾“å±‚TCPåªä¼ è¾“å­—èŠ‚æµï¼ŒHTTPæ•°æ®åŒ…ï¼ŒåŒ…å«çš„æ˜¯æ–‡æœ¬å†…å®¹ï¼Œå› æ­¤ï¼Œæ¥æ”¶åˆ°HTTPæ•°æ®åŒ…åï¼Œåº”ç”¨å±‚éœ€è¦ä»äºŒè¿›åˆ¶æµä¸­è§£æå‡ºHTTPæ•°æ®åŒ…çš„æ–‡æœ¬å†…å®¹ï¼Œä¸€æ—¦æ¶‰åŠåˆ°å­—èŠ‚å’Œå­—ç¬¦è½¬æ¢ï¼Œå°±æœ‰ç¼–ç 

> HTTP 1.1 uses US-ASCII as basic character set for the request line in requests, the status line in responses (except the reason phrase) and the field names but allows any octet in the field values and the message body.

HTTP1.1åè®®è§„å®šï¼ŒåŸºæœ¬çš„å­—ç¬¦ç¼–ç æ˜¯US-ASCI

å‚è€ƒï¼š

https://blog.csdn.net/honghailiang888/article/details/49901993

https://stackoverflow.com/questions/818122/which-encoding-is-used-by-the-http-protocol

https://juejin.im/post/5d521575f265da03ee6a4bda





